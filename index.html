<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Cookbook" href="cookbook_rst.html" />

    <!-- Generated with Sphinx 8.2.3 and Furo 2025.07.19 -->
        <title>pyziggy 0.9.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d111a655" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=25af2a20" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=8dab3a3b" />
    
    


<style>
  body {
    --color-code-background: #f2f2f2;
  --color-code-foreground: #1e1e1e;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #2b2b2b;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="#"><div class="brand">pyziggy 0.9.1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="#">
  
  <span class="sidebar-brand-text">pyziggy 0.9.1 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">The basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="cookbook_rst.html">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command-line reference</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api.html">API reference</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of API reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="generated/pyziggy.broadcasters.html">pyziggy.broadcasters</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/pyziggy.devices_client.html">pyziggy.devices_client</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/pyziggy.device_bases.html">pyziggy.device_bases</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/pyziggy.message_loop.html">pyziggy.message_loop</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/pyziggy.parameters.html">pyziggy.parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/pyziggy.util.html">pyziggy.util</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/pyziggy.workarounds.html">pyziggy.workarounds</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/pyziggy.cli.html">pyziggy.cli</a></li>
<li class="toctree-l2"><a class="reference internal" href="generated/pyziggy.run.html">pyziggy.run</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/index.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="pyziggy">
<h1>pyziggy<a class="headerlink" href="#pyziggy" title="Link to this heading">¶</a></h1>
<p><a class="reference external" href="https://github.com/bebump/pyziggy">Source&#64;Github</a>　—　<a class="reference external" href="https://pyziggy.github.io">Documentation</a>　—　<a class="reference external" href="https://pypi.org/project/pyziggy">PyPI</a></p>
<hr class="docutils" />
<p>Control Zigbee2MQTT with Python scripts and no boilerplate. Based on a configuration file the <code class="docutils literal notranslate"><span class="pre">pyziggy</span> <span class="pre">run</span></code> command will</p>
<ul class="simple">
<li><p>connect to an MQTT server</p></li>
<li><p>download the device information posted by Zigbee2MQTT</p></li>
<li><p>generate Python classes for each parameter under each device</p>
<ul>
<li><p>in a way where each parameter will have setters, getters or query functions based on the reported access flags</p></li>
</ul>
</li>
<li><p>relay MQTT communication between the broker and these generated classes</p></li>
<li><p>load a user specified script, which can import said autogenerated classes, and use mypy to check the correctness of it</p></li>
<li><p>maintain MQTT communication until the user decides to terminate it.</p></li>
</ul>
<p>This way instead of composing and parsing MQTT messages, user scripts can mutate Python objects to interact with the Zigbee network. Using an IDE you should have full code completion to take the guesswork out of interacting with your smart devices.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your IDE should offer valid choices after each press of .</span>
<span class="n">devices</span><span class="o">.</span><span class="n">color_bulb</span><span class="o">.</span><span class="n">brightness</span><span class="o">.</span><span class="n">set_normalized</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
<p>The optional Flask integration makes it easy for scripts to expose an HTTP interface that interacts with the device objects.</p>
<section id="getting-started">
<h2>Getting started<a class="headerlink" href="#getting-started" title="Link to this heading">¶</a></h2>
<p>First you need a working <a class="reference external" href="https://www.zigbee2mqtt.io">Zigbee2MQTT</a> installation. You should be able to reach the MQTT broker from the machine that’s meant to run pyziggy. Please refer to the Zigbee2MQTT documentation for details about this.</p>
<p>If you have a Python 3.12+ environment, you can install pyziggy with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">pyziggy</span>
</pre></div>
</div>
<p>Create an empty directory for your automation scripts. Navigate to it and issue</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pyziggy</span> <span class="n">run</span> <span class="n">automation</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>and follow the instructions.</p>
</section>
<section id="a-minimal-automation-project">
<h2>A minimal automation project<a class="headerlink" href="#a-minimal-automation-project" title="Link to this heading">¶</a></h2>
<p><em><strong>Side note:</strong> I like to set up a virtual environment in the <code class="docutils literal notranslate"><span class="pre">.venv</span></code> subdirectory of my project directory. I do this with the <a href="cookbook.html#working-with-the-pyziggy-setup-script">pyziggy-setup script</a>.</em></p>
<hr class="docutils" />
<p>The rest of the documentation will assume, that you set up an automation project by issuing the following commands.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">my_automation</span>
<span class="n">cd</span> <span class="n">my_automation</span>
<span class="n">pyziggy</span> <span class="n">run</span> <span class="n">automation</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Pyziggy will create a default <code class="docutils literal notranslate"><span class="pre">config.toml</span></code> file in the directory, instruct you to edit it and exit. After specifying your MQTT connection details, you need to issue the command again:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pyziggy</span> <span class="n">run</span> <span class="n">automation</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>This would result in the following directory contents.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>my_automation/
├─ pyziggy_autogenerate/
│  └─ available_devices.py
├─ automation.py
└─ config.toml
</pre></div>
</div>
<p>After the first execution of <code class="docutils literal notranslate"><span class="pre">pyziggy</span> <span class="pre">run</span> <span class="pre">automation.py</span></code> you were instructed to edit the <code class="docutils literal notranslate"><span class="pre">config.toml</span></code> file so that it contains accurate information about connecting to the MQTT broker.</p>
<p>The contents of the initially autogenerated (but editable) <code class="docutils literal notranslate"><span class="pre">automation.py</span></code> file would be as follows</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pyziggy_autogenerate.available_devices</span><span class="w"> </span><span class="kn">import</span> <span class="n">AvailableDevices</span>

<span class="n">devices</span> <span class="o">=</span> <span class="n">AvailableDevices</span><span class="p">()</span>
</pre></div>
</div>
<p>Although it won’t do much, this is a fully formed automation module file that’s ready to go.</p>
</section>
<section id="next-steps">
<h2>Next steps<a class="headerlink" href="#next-steps" title="Link to this heading">¶</a></h2>
<p>The way to get the most out of pyziggy is to use an IDE with code completion features. PyCharm is my favourite, which is free for non-professional use. If your automation directory contains a virtual environment in <code class="docutils literal notranslate"><span class="pre">.venv</span></code>, all you need to do is open it in PyCharm, and it should be correctly configured.</p>
<p>Open your <code class="docutils literal notranslate"><span class="pre">automation.py</span></code> file and start editing it. Typing <code class="docutils literal notranslate"><span class="pre">devices.</span></code> should show you suggestions for all the devices that Zigbee2MQTT knows about. Going further and typing e.g. <code class="docutils literal notranslate"><span class="pre">devices.color_bulb.</span></code> will show suggestions for all the parameters of <code class="docutils literal notranslate"><span class="pre">color_bulb</span></code> that can be queried, set or both. Not every parameter is settable, in which case it will not have setter functions.</p>
<p>All public members of <code class="docutils literal notranslate"><span class="pre">devices</span></code> are your actual devices that Zigbee2MQTT knows about and pyziggy could successfully parse. And all public members of each device are parameters, such as <code class="docutils literal notranslate"><span class="pre">brightness</span></code> or <code class="docutils literal notranslate"><span class="pre">color_temp</span></code> in case of a smart light bulb.</p>
<p>Most home automation tasks can be implemented by</p>
<ul class="simple">
<li><p>calling setters and getters on the parameters in <a class="reference internal" href="generated/pyziggy.parameters.html#module-pyziggy.parameters" title="pyziggy.parameters"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyziggy.parameters</span></code></a></p></li>
<li><p>attaching change listeners to…</p>
<ul>
<li><p>your parameters: <a class="reference internal" href="generated/pyziggy.parameters.html#pyziggy.parameters.ParameterBase" title="pyziggy.parameters.ParameterBase"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyziggy.parameters.ParameterBase</span></code></a></p></li>
<li><p>the global <code class="docutils literal notranslate"><span class="pre">on_connect</span></code> event on the <code class="docutils literal notranslate"><span class="pre">devices</span></code> variable: <a class="reference internal" href="generated/pyziggy.devices_client.html#pyziggy.devices_client.DevicesClient.on_connect" title="pyziggy.devices_client.DevicesClient.on_connect"><code class="xref py py-attr docutils literal notranslate"><span class="pre">pyziggy.devices_client.DevicesClient.on_connect</span></code></a></p></li>
</ul>
</li>
<li><p>creating <a class="reference internal" href="generated/pyziggy.message_loop.html#pyziggy.message_loop.MessageLoopTimer" title="pyziggy.message_loop.MessageLoopTimer"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyziggy.message_loop.MessageLoopTimer</span></code></a> objects that can interact with the parameters in a thread-safe way</p></li>
</ul>
</section>
<section id="a-full-example">
<h2>A full example<a class="headerlink" href="#a-full-example" title="Link to this heading">¶</a></h2>
<p>A complete automation project running in our home is available at <a class="reference external" href="https://github.com/bebump/pyziggy-example">https://github.com/bebump/pyziggy-example</a>.</p>
<p>For simpler examples with more explanation, see the <a class="reference internal" href="cookbook.html"><span class="doc std std-doc">Cookbook</span></a> chapter.</p>
</section>
<section id="startup-sequence">
<h2>Startup sequence<a class="headerlink" href="#startup-sequence" title="Link to this heading">¶</a></h2>
<p>Understanding the inner workings of pyziggy can be helpful for debugging or supporting advanced use-cases, but for getting started it isn’t necessary. For the curious, there are even more explanations spread out over the API reference.</p>
<p>At this point, after issuing the <code class="docutils literal notranslate"><span class="pre">pyziggy</span> <span class="pre">run</span> <span class="pre">automation.py</span></code> command in the <code class="docutils literal notranslate"><span class="pre">my_automation</span></code> directory, pyziggy will</p>
<ol class="arabic simple">
<li><p>Check that the <code class="docutils literal notranslate"><span class="pre">config.toml</span></code> file is correct and connection to the MQTT broker is possible.</p></li>
<li><p>Connect to the MQTT broker and wait for a message on the <code class="docutils literal notranslate"><span class="pre">bridge/devices</span></code> topic.</p>
<ol class="arabic simple">
<li><p>If it receives the message, it regenerates the <code class="docutils literal notranslate"><span class="pre">pyziggy_autogenerate/available_devices.py</span></code> file based on its contents. The file should now only contain devices and parameters of devices that the MQTT broker presently knows about.</p></li>
<li><p>If the message isn’t received for 5 seconds, the program times out and exits with code <code class="docutils literal notranslate"><span class="pre">1</span></code>. This allows service management daemons to detect the error condition, and retry later or take some other action.</p></li>
</ol>
</li>
<li><p>Checks the correctness of <code class="docutils literal notranslate"><span class="pre">automation.py</span></code> by running mypy. For example, if <code class="docutils literal notranslate"><span class="pre">automation.py</span></code> is trying to access a device or a parameter of the device that doesn’t exist, or is misspelled, that will generate an error at this point and the program will exit with code <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p>Imports the <code class="docutils literal notranslate"><span class="pre">automation.py</span></code> module. Checks that it has exactly one public member object that is an instance of the <code class="docutils literal notranslate"><span class="pre">DevicesClient</span></code> class. <code class="docutils literal notranslate"><span class="pre">AvailableDevices</span></code> inherits from <code class="docutils literal notranslate"><span class="pre">DevicesClient</span></code> so the <code class="docutils literal notranslate"><span class="pre">devices</span></code> object will pass this check. If this check fails, the program exits with code <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p>Checks whether the <code class="docutils literal notranslate"><span class="pre">automation.py</span></code> module defines a member object that is an instance of the <code class="docutils literal notranslate"><span class="pre">flask.Flask</span></code> class. This is optional and failing this check has no consequence.</p>
<ol class="arabic simple">
<li><p>If a <code class="docutils literal notranslate"><span class="pre">Flask</span></code> object was found, a web server is started listening on the port specified by <code class="docutils literal notranslate"><span class="pre">flask_port</span></code> in <code class="docutils literal notranslate"><span class="pre">config.toml</span></code>. Requests sent to this port are routed to the <code class="docutils literal notranslate"><span class="pre">Flask</span></code> object.</p></li>
</ol>
</li>
<li><p>The program initiates a connection to the MQTT broker and enters an infinite message loop. On sucessful connection the listeners of the <code class="docutils literal notranslate"><span class="pre">DevicesClient.on_connect</span></code> <a class="reference internal" href="generated/pyziggy.broadcasters.html#pyziggy.broadcasters.Broadcaster" title="pyziggy.broadcasters.Broadcaster"><code class="xref py py-class docutils literal notranslate"><span class="pre">pyziggy.broadcasters.Broadcaster</span></code></a> are called.</p></li>
<li><p>Upon receiving the SIGINT signal, the program stops the infinite loop and cleanly exits with code <code class="docutils literal notranslate"><span class="pre">0</span></code>. You can use <code class="docutils literal notranslate"><span class="pre">CTRL+C</span></code> to send SIGINT if running pyziggy in the terminal.</p></li>
</ol>
</section>
<section id="running-as-a-service">
<h2>Running as a service<a class="headerlink" href="#running-as-a-service" title="Link to this heading">¶</a></h2>
<p>Pyziggy was designed with running as a service in mind. I only know how to do this on MacOS, but this information can probably be adapted to other platforms as well.</p>
<section id="macos">
<h3>MacOS<a class="headerlink" href="#macos" title="Link to this heading">¶</a></h3>
<p>You need to add the following <code class="docutils literal notranslate"><span class="pre">.plist</span></code> file to <code class="docutils literal notranslate"><span class="pre">$HOME/Library/LaunchAgents</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
&lt;dict&gt;
    &lt;key&gt;Label&lt;/key&gt;
    &lt;string&gt;net.bebump.pyziggy/string&gt;

    &lt;key&gt;ProgramArguments&lt;/key&gt;
    &lt;array&gt;
        &lt;string&gt;/Users/ExampleUser/my_automation/.venv/bin/python&lt;/string&gt;
        &lt;string&gt;-m&lt;/string&gt;
        &lt;string&gt;pyziggy&lt;/string&gt;
        &lt;string&gt;run&lt;/string&gt;
        &lt;string&gt;/Users/ExampleUser/my_automation/automation.py&lt;/string&gt;
    &lt;/array&gt;

    &lt;key&gt;WorkingDirectory&lt;/key&gt;
    &lt;string&gt;/Users/ExampleUser/my_automation&lt;/string&gt;

    &lt;key&gt;RunAtLoad&lt;/key&gt;
    &lt;true/&gt;

    &lt;key&gt;KeepAlive&lt;/key&gt;
    &lt;true/&gt;

    &lt;key&gt;StandardOutPath&lt;/key&gt;
    &lt;string&gt;/tmp/net.bebump.pyziggy/stdout.log&lt;/string&gt;

    &lt;key&gt;StandardErrorPath&lt;/key&gt;
    &lt;string&gt;/tmp/net.bebump.pyziggy/stderr.log&lt;/string&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</pre></div>
</div>
<p>You can start the service by issuing</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">launchctl</span> <span class="n">load</span> <span class="o">~/</span><span class="n">Library</span><span class="o">/</span><span class="n">LaunchAgents</span><span class="o">/</span><span class="n">net</span><span class="o">.</span><span class="n">bebump</span><span class="o">.</span><span class="n">pyziggy</span><span class="o">.</span><span class="n">plist</span>
</pre></div>
</div>
<p>and stop and uninstall it by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">launchctl</span> <span class="n">unload</span> <span class="n">net</span><span class="o">.</span><span class="n">bebump</span><span class="o">.</span><span class="n">pyziggy</span><span class="o">.</span><span class="n">plist</span> <span class="o">&amp;&amp;</span> <span class="n">rm</span> <span class="o">~/</span><span class="n">Library</span><span class="o">/</span><span class="n">LaunchAgents</span><span class="o">/</span><span class="n">net</span><span class="o">.</span><span class="n">bebump</span><span class="o">.</span><span class="n">pyziggy</span><span class="o">.</span><span class="n">plist</span>
</pre></div>
</div>
</section>
</section>
</section>
<div class="toctree-wrapper compound">
</div>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="cookbook_rst.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Cookbook</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2025, Attila Szarvas
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">pyziggy</a><ul>
<li><a class="reference internal" href="#getting-started">Getting started</a></li>
<li><a class="reference internal" href="#a-minimal-automation-project">A minimal automation project</a></li>
<li><a class="reference internal" href="#next-steps">Next steps</a></li>
<li><a class="reference internal" href="#a-full-example">A full example</a></li>
<li><a class="reference internal" href="#startup-sequence">Startup sequence</a></li>
<li><a class="reference internal" href="#running-as-a-service">Running as a service</a><ul>
<li><a class="reference internal" href="#macos">MacOS</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=9dc39874"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=46bd48cc"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    </body>
</html>